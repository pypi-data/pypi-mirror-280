import{d as E,r as m,o as Y,a as x,b as n,c as d,e,f as s,w as te,g as p,h,i as V,t as $,F as P,j as M,E as J,_ as O,u as L,k as X,l as le,m as I,n as Z,p as A,q as N,s as ne,v as B,x as F,y as G,z as oe}from"./index-q3moIBed.js";import{h as D}from"./axios--FnjuHWf.js";/* empty css                                                                       */import{_ as se}from"./HomeView.vue_vue_type_script_setup_true_lang-oo2jtXUQ.js";const ae={style:{padding:"10px 10px"}},ie={key:0},re={key:1},ce={key:0},de={key:1},ue=e("br",null,null,-1),_e={key:2,style:{color:"#909399","font-size":"12px"}},pe=E({__name:"ContactsList",emits:["wxid"],setup(t,{emit:r}){const l=m([]),a=m({}),o=async()=>{try{return await D.post("/api/recent_user_list",{})}catch(u){return console.error("Error fetching data:",u),[]}},c=async(u="")=>{try{return await D.post("/api/user_list",{word:u})}catch(U){return console.error("Error fetching data:",U),[]}},y=async()=>{try{return await D.post("/api/user_labels_dict",{})}catch(u){return console.error("Error fetching data:",u),[]}},v=u=>{let U="";if(u.length===0)return"";for(let R=0;R<u.length;R++)U+=a.value[u[R]]+" ";return U};Y(async()=>{try{l.value=await o(),a.value=await y()}catch(u){return console.error("Error fetching data:",u),[]}});const w=m(""),f=async()=>{try{if(w.value===""){l.value=await o();return}l.value=await c(w.value)}catch(u){return console.error("Error fetching data:",u),[]}},k=r,q=u=>{u!==void 0&&k("wxid",u.wxid)};return(u,U)=>{const R=x("el-input"),H=x("el-button"),j=x("el-avatar"),g=x("el-table-column"),T=x("el-tooltip"),C=x("el-table");return n(),d("div",null,[e("div",ae,[s(R,{placeholder:"请输入关键字",modelValue:w.value,"onUpdate:modelValue":U[0]||(U[0]=i=>w.value=i),onKeyup:te(f,["enter"]),style:{width:"170px","margin-left":"15px"}},null,8,["modelValue"]),s(H,{type:"primary",onClick:f,style:{width:"50px"}},{default:p(()=>[h("搜索")]),_:1})]),s(C,{data:l.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:q},{default:p(()=>[s(g,{width:"57"},{default:p(({row:i})=>[i.headImgUrl!==""?(n(),V(j,{key:0,size:33,src:"/api/imgsrc/"+i.headImgUrl},null,8,["src"])):(n(),V(j,{key:1,size:33},{default:p(()=>[h(" 群聊 ")]),_:1}))]),_:1}),s(g,{width:"190"},{default:p(({row:i})=>[i.LabelIDList.length>0?(n(),V(T,{key:0,class:"item",effect:"light",content:v(i.LabelIDList),placement:"right"},{default:p(()=>[i.remark!==null&&i.remark!==""?(n(),d("span",ie,$(i.remark),1)):(n(),d("span",re,$(i.nickname),1))]),_:2},1032,["content"])):(n(),d(P,{key:1},[i.remark!==null&&i.remark!==""?(n(),d("span",ce,$(i.remark),1)):(n(),d("span",de,$(i.nickname),1))],64)),ue,i.LastReadedCreateTime?(n(),d("span",_e,$(i.LastReadedCreateTime),1)):M("",!0)]),_:1})]),_:1},8,["data"])])}}}),ve=E({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},emits:["exporting"],setup(t,{emit:r}){const l=m(!1),a=async()=>{if(l.value){console.log("正在获取实时消息，请稍后再试!");return}l.value=!0;try{const _=await D.post("/api/realtimemsg",{});return l.value=!1,J({title:"Success",message:"获取实时消息成功!",type:"success"}),_}catch(_){return l.value=!1,J({title:"Error",message:"获取实时消息失败!",type:"error"}),console.error("Error fetching data:",_),[]}},o=m(!1),c=r,y=()=>{c("exporting",!0),o.value=!0},v=()=>{c("exporting",!1),o.value=!1};return(_,w)=>{const f=x("el-text"),k=x("el-col"),q=x("el-row");return n(),d(P,null,[s(q,{gutter:5,style:{width:"100%"}},{default:p(()=>[s(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("wxid:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.wxid},{default:p(()=>[h($(t.userData.wxid),1)]),_:1},8,["title"])]),_:1}),s(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("账号:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.account},{default:p(()=>[h($(t.userData.account),1)]),_:1},8,["title"])]),_:1}),s(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("昵称:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.nickname},{default:p(()=>[h($(t.userData.nickname),1)]),_:1},8,["title"])]),_:1}),s(k,{span:6,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("备注:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.remark},{default:p(()=>[h($(t.userData.remark),1)]),_:1},8,["title"])]),_:1})]),_:1}),s(q,{gutter:5,style:{width:"100%"}},{default:p(()=>[s(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("数量:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.msg_count},{default:p(()=>[h($(t.userData.msg_count),1)]),_:1},8,["title"])]),_:1}),s(k,{span:15,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"label_color mx-1",truncated:""},{default:p(()=>[h("描述:")]),_:1}),h("  "),s(f,{class:"data_color mx-1",truncated:"",title:t.userData.describe},{default:p(()=>[h($(t.userData.describe),1)]),_:1},8,["title"])]),_:1}),s(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[s(f,{class:"button_color mx-1 underline",truncated:"",onClick:w[0]||(w[0]=u=>{a()})},{default:p(()=>[h("实时消息 "),l.value?(n(),d(P,{key:0},[h("(获取中)")],64)):M("",!0)]),_:1})]),_:1}),s(k,{span:3,style:{"white-space":"nowrap"}},{default:p(()=>[o.value?M("",!0):(n(),V(f,{key:0,class:"button_color mx-1 underline",truncated:"",onClick:w[1]||(w[1]=u=>{y()})},{default:p(()=>[h("导出备份")]),_:1})),o.value?(n(),V(f,{key:1,class:"button_color mx-1 underline",truncated:"",onClick:w[2]||(w[2]=u=>{v()})},{default:p(()=>[h("聊天查看")]),_:1})):M("",!0)]),_:1})]),_:1})],64)}}}),he=O(ve,[["__scopeId","data-v-0c9eea5d"]]),me={class:"chat-content"},fe={key:0,class:"word"},ye=["src"],xe={class:"info"},we={class:"time"},ge=["innerHTML"],be={key:1,class:"word-my"},$e={class:"info"},ke={class:"time"},Se=["innerHTML"],Ve=["src"],Ue=E({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const r=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(n(),d("div",me,[t.is_sender?(n(),d("div",be,[e("div",$e,[e("p",ke,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,Se)]),e("img",{src:t.headUrl},null,8,Ve)])):(n(),d("div",fe,[e("img",{src:t.headUrl},null,8,ye),e("div",xe,[e("p",we,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,ge)])]))]))}}),Me=O(Ue,[["__scopeId","data-v-d930be9e"]]),Ee={class:"chat-content"},Ce={key:0,class:"word"},Te=["src"],De={class:"info"},qe={class:"time"},ze={class:"demo-image__preview"},Re={key:1,class:"word-my"},je={class:"info"},He={class:"time"},Ie={class:"demo-image__preview"},Oe=["src"],Le=E({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>{const a=x("el-image");return n(),d("div",Ee,[t.is_sender?(n(),d("div",Re,[e("div",je,[e("p",He,$(t.direction),1),e("div",Ie,[s(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Oe)])):(n(),d("div",Ce,[e("img",{src:t.headUrl},null,8,Te),e("div",De,[e("p",qe,$(t.direction),1),e("div",ze,[s(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Ne=O(Le,[["__scopeId","data-v-24d6aaa0"]]),Be={class:"chat-content"},Fe={key:0,class:"word"},Ae=["src"],Pe={class:"info"},We={class:"time"},Ke={class:"demo-video__preview"},Ge={controls:"",width:"30%"},Ye=["src"],Je={key:1,class:"word-my"},Xe={class:"info"},Qe={class:"time"},Ze={class:"demo-video__preview"},et={controls:"",width:"50%"},tt=["src"],lt=["src"],nt=E({__name:"MessageVideo",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>(n(),d("div",Be,[t.is_sender?(n(),d("div",Je,[e("div",Xe,[e("p",Qe,$(t.direction),1),e("div",Ze,[e("video",et,[e("source",{src:t.src,type:"video/mp4"},null,8,tt)])])]),e("img",{src:t.headUrl},null,8,lt)])):(n(),d("div",Fe,[e("img",{src:t.headUrl},null,8,Ae),e("div",Pe,[e("p",We,$(t.direction),1),e("div",Ke,[e("video",Ge,[e("source",{src:t.src,type:"video/mp4"},null,8,Ye)])])])]))]))}}),ot=O(nt,[["__scopeId","data-v-5aa79515"]]),st={class:"chat-content"},at={key:0,class:"word"},it=["src"],rt={class:"info"},ct={class:"time"},dt={controls:"",style:{"background-color":"#fff"}},ut=["src"],_t={key:1,class:"word-my"},pt={class:"info"},vt={class:"time"},ht={controls:"",style:{"background-color":"#95EC69"}},mt=["src"],ft=["src"],yt=E({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(t){return(r,l)=>(n(),d("div",st,[t.is_sender?(n(),d("div",_t,[e("div",pt,[e("p",vt,$(t.direction),1),e("audio",ht,[e("source",{src:t.src,type:"audio/wav"},null,8,mt)]),s(L(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:t.headUrl},null,8,ft)])):(n(),d("div",at,[e("img",{src:t.headUrl},null,8,it),e("div",rt,[e("p",ct,$(t.direction),1),e("audio",dt,[e("source",{src:t.src,type:"audio/wav"},null,8,ut)]),s(L(X),{rows:1,readonly:!0,value:t.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),xt=O(yt,[["__scopeId","data-v-0d0f2cd4"]]),wt={class:"chat-content"},gt={key:0,class:"word"},bt=["src"],$t={class:"info"},kt={class:"time"},St={style:{float:"left"}},Vt=["href"],Ut={key:1,class:"word-my"},Mt={class:"info"},Et={class:"time"},Ct={style:{float:"right"}},Tt=["href"],Dt=["src"],qt=E({__name:"MessageFile",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){const r=t,l=m(""),a=le({file_name:String,file_size:Number,file_size_unit:String});Y(async()=>{console.log("文件加载中");const c=await o(r.src);a.file_name=c.file_name,a.file_size=Number(c.file_size)/1024,a.file_size<1024?a.file_size_unit="kb":(a.file_size=a.file_size/1024,a.file_size_unit="mb"),a.file_size=Number(c.file_size)/1024,l.value=`/api/file/${r.src}`});const o=async c=>{try{return await D.post("/api/file_info",{file_path:c})}catch(y){return console.error("Error fetching file_info:",y),""}};return(c,y)=>{const v=x("el-card");return n(),d("div",wt,[t.is_sender?(n(),d("div",Ut,[e("div",Mt,[e("p",Et,$(t.direction),1),e("div",Ct,[s(v,{shadow:"hover",style:{width:"fit-content"}},{default:p(()=>[h("文件 ： "),e("a",{href:l.value,download:""},$(a.file_name),9,Tt),e("div",null,[h(" 文件大小："),e("span",null,$(a.file_size)+$(a.file_size_unit),1)])]),_:1})])]),e("img",{src:t.headUrl},null,8,Dt)])):(n(),d("div",gt,[e("img",{src:t.headUrl},null,8,bt),e("div",$t,[e("p",kt,$(t.direction),1),e("div",St,[s(v,{shadow:"hover",style:{width:"fit-content"}},{default:p(()=>[h("文件 ： "),e("a",{href:l.value,download:""},$(a.file_name),9,Vt),e("div",null,[h(" 文件大小："),e("span",null,$(a.file_size)+$(a.file_size_unit),1)])]),_:1})])])]))])}}}),zt=O(qt,[["__scopeId","data-v-e797f204"]]),Rt={class:"chat-content"},jt={key:0,class:"word"},Ht=["src"],It={class:"info"},Ot={class:"time"},Lt={class:"demo-image__preview"},Nt={key:1,class:"word-my"},Bt={class:"info"},Ft={class:"time"},At={class:"demo-image__preview"},Pt=["src"],Wt=E({__name:"MessageEmoji",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(t){return(r,l)=>{const a=x("el-image");return n(),d("div",Rt,[t.is_sender?(n(),d("div",Nt,[e("div",Bt,[e("p",Ft,$(t.direction),1),e("div",At,[s(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:t.headUrl},null,8,Pt)])):(n(),d("div",jt,[e("img",{src:t.headUrl},null,8,Ht),e("div",It,[e("p",Ot,$(t.direction),1),e("div",Lt,[s(a,{style:{"max-width":"150px","max-height":"150px"},src:t.src,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.src],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Kt=O(Wt,[["__scopeId","data-v-ad34c109"]]),Gt={class:"chat-content"},Yt={key:0,class:"word"},Jt=["src"],Xt={class:"info"},Qt={class:"time"},Zt=["innerHTML"],el={key:1,class:"word-my"},tl={class:"info"},ll={class:"time"},nl=["innerHTML"],ol=["src"],sl=E({__name:"MessageOther",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(t){const r=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,a)=>(n(),d("div",Gt,[t.is_sender?(n(),d("div",el,[e("div",tl,[e("p",ll,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,nl)]),e("img",{src:t.headUrl},null,8,ol)])):(n(),d("div",Yt,[e("img",{src:t.headUrl},null,8,Jt),e("div",Xt,[e("p",Qt,$(t.direction),1),e("div",{class:"info-content",innerHTML:r(t.content)},null,8,Zt)])]))]))}}),al=O(sl,[["__scopeId","data-v-e529325a"]]),il={id:"chat"},rl={class:"chat_body"},cl={class:"chat_window",ref:"chatWindow"},dl={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},ul=E({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(t,{expose:r}){const l=t,a=m([]),o=m({}),c=m(!1),y=m(""),v=m(0),_=m(100),w=m(0),f=m(!1),k=async(g,T,C)=>{if(c.value){console.log("正在获取消息，请稍后再试!");return}if(C==""){console.log("wxid 为空, 请检查!");return}try{c.value=!0,g<0&&(g=0);const i=await D.post("/api/msgs",{start:g,limit:T,wxid:C});return a.value=i.msg_list,o.value=Object.assign(o.value,i.user_list),c.value=!1,i}catch(i){return c.value=!1,console.error("Error fetching data:",i),[]}},q=async g=>{try{return(await D.post("/api/msg_count",{wxid:g}))[g]}catch(T){return console.error("Error fetching data msg_count:",T),[]}},u=async()=>{try{return(await D.get("/api/mywxid")).my_wxid}catch(g){return console.error("Error fetching data my_wxid:",g),[]}},U=async()=>{try{y.value=await u(),w.value=await q(l.userData.wxid),v.value=w.value-_.value,v.value<0&&(v.value=0),await k(v.value,_.value,l.userData.wxid),f.value||await A(()=>{l.setScrollTop(),f.value=!1})}catch(g){return console.error("Error fetching data:",g),[]}};I(()=>l.userData.wxid,(g,T)=>{console.log("username changed： ",T,g),a.value=[],o.value={},f.value=!1,w.value=0,v.value=0,U()});const R=async()=>{y.value=await u(),w.value=await q(l.userData.wxid);let g=_.value,T=v.value-g;T<0&&(T=0);const C=await k(T,g,l.userData.wxid);v.value=T,console.log("loadMore",T,v.value,g,l.userData.wxid),a.value=C.msg_list.concat(a.value),a.value.sort((i,S)=>i.id-S.id),a.value=a.value.filter((i,S,b)=>S===0||i.id!==b[S-1].id),o.value=Object.assign(o.value,C.user_list),await A(()=>{l.updateScrollTop()})};r({loadMore:R});const H=g=>(g.talker=="我"&&(g.talker=y.value),`${(C=>o.value.hasOwnProperty(C.talker)?o.value[C.talker].remark?o.value[C.talker].remark:o.value[C.talker].nickname?o.value[C.talker].nickname:o.value[C.talker].account?o.value[C.talker].account:C.talker:C.talker)(g)} [${g.type_name}] ${g.CreateTime}`),j=g=>(g.talker=="我"&&(g.talker=y.value),o.value.hasOwnProperty(g.talker)?"/api/imgsrc/"+o.value[g.talker].headImgUrl:"");return(g,T)=>{const C=x("el-button");return n(),d("div",il,[e("div",rl,[e("div",cl,[a.value.length<w.value?(n(),d("div",dl,[s(C,{type:"primary",onClick:R},{default:p(()=>[h("查看更多消息")]),_:1})])):M("",!0),(n(!0),d(P,null,Z(a.value,(i,S)=>(n(),d("div",{class:"message",key:S},[i.type_name=="文本"?(n(),V(Me,{key:0,is_sender:i.is_sender,direction:H(i),headUrl:j(i),content:i.content.msg},null,8,["is_sender","direction","headUrl","content"])):i.type_name=="图片"?(n(),V(Ne,{key:1,is_sender:i.is_sender,direction:H(i),headUrl:j(i),src:"/api/img/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="动画表情"?(n(),V(Kt,{key:2,is_sender:i.is_sender,direction:H(i),headUrl:j(i),src:"/api/imgsrc/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="视频"?(n(),V(ot,{key:3,is_sender:i.is_sender,direction:H(i),headUrl:j(i),src:"/api/video/"+i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="文件"?(n(),V(zt,{key:4,is_sender:i.is_sender,direction:H(i),headUrl:j(i),src:i.content.src},null,8,["is_sender","direction","headUrl","src"])):i.type_name=="语音"?(n(),V(xt,{key:5,is_sender:i.is_sender,direction:H(i),headUrl:j(i),src:"/api/"+i.content.src,msg:i.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):(n(),V(al,{key:6,is_sender:i.is_sender,direction:H(i),headUrl:j(i),content:i.content.msg},null,8,["is_sender","direction","headUrl","content"]))]))),128))],512)])])}}}),_l=O(ul,[["__scopeId","data-v-49e80cb1"]]),pl=e("br",null,null,-1),vl=e("br",null,null,-1),hl={style:{position:"relative"}},ml=E({__name:"ExportENDB",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(c,y)=>{console.log(c)});const l=m(""),a=m(""),o=async()=>{a.value="请求中...";try{a.value=await D.post("/api/export_endb",{wx_path:l.value})}catch(c){return console.error("Error fetching data msg_count:",c),a.value=`请求失败
`+c,[]}};return(c,y)=>{const v=x("el-input"),_=x("el-button"),w=x("el-divider");return n(),d("div",null,[h(" 微信文件夹路径(可选)： "),s(v,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":y[0]||(y[0]=f=>l.value=f),style:{width:"70%"}},null,8,["modelValue"]),pl,vl,e("div",hl,[s(_,{type:"primary",onClick:y[1]||(y[1]=f=>o())},{default:p(()=>[h("导出")]),_:1})]),s(w),s(v,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:a.value,"onUpdate:modelValue":y[2]||(y[2]=f=>a.value=f),style:{width:"100%"}},null,8,["modelValue"])])}}}),fl=e("br",null,null,-1),yl=e("br",null,null,-1),xl=e("br",null,null,-1),wl=e("br",null,null,-1),gl={style:{position:"relative"}},bl=E({__name:"ExportDEDB",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(y,v)=>{console.log(y)});const l=m(""),a=m(""),o=m(""),c=async()=>{o.value="正在处理中...";try{o.value=await D.post("/api/export_dedb",{key:a.value,wx_path:l.value})}catch(y){return console.error("Error fetching data msg_count:",y),o.value=`请求失败
`+y,[]}};return(y,v)=>{const _=x("el-input"),w=x("el-button"),f=x("el-divider");return n(),d("div",null,[h(" 密钥(可选)： "),s(_,{placeholder:"密钥[可为空,空表示使用默认的，无默认会报错]",modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=k=>a.value=k),style:{width:"75%"}},null,8,["modelValue"]),fl,yl,h(" 微信文件夹路径(可选)： "),s(_,{placeholder:"微信文件夹路径[可为空,空表示使用默认的，无默认会报错](eg: C:\\****\\WeChat Files\\wxid_**** )",modelValue:l.value,"onUpdate:modelValue":v[1]||(v[1]=k=>l.value=k),style:{width:"70%"}},null,8,["modelValue"]),xl,wl,e("div",gl,[s(w,{type:"primary",onClick:v[2]||(v[2]=k=>c())},{default:p(()=>[h("导出")]),_:1})]),s(f),s(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:o.value,"onUpdate:modelValue":v[3]||(v[3]=k=>o.value=k),style:{width:"100%"}},null,8,["modelValue"])])}}}),$l={style:{position:"relative"}},kl=E({__name:"ExportCSV",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(o,c)=>{console.log(o)});const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await D.post("/api/export_csv",{wxid:r.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),l.value=`请求失败
`+o,[]}};return(o,c)=>{const y=x("el-button"),v=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",$l,[s(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[h("导出")]),_:1})]),s(v),s(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Sl={style:{position:"relative"}},Vl=E({__name:"ExportJSON",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(o,c)=>{console.log(o)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await D.post("/api/export_json",{wxid:r.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),l.value=`请求失败
`+o,[]}};return(o,c)=>{const y=x("el-button"),v=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",Sl,[s(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[h("导出")]),_:1})]),s(v),s(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),Ul={style:{position:"relative"}},Ml=E({__name:"ExportHTML",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(o,c)=>{console.log(o)}),m([]);const l=m(""),a=async()=>{l.value="正在处理中...";try{l.value=await D.post("/api/export_html",{wxid:r.wxid})}catch(o){return console.error("Error fetching data msg_count:",o),l.value=`请求失败
`+o,[]}};return(o,c)=>{const y=x("el-button"),v=x("el-divider"),_=x("el-input");return n(),d("div",null,[e("div",Ul,[s(y,{type:"primary",onClick:c[0]||(c[0]=w=>a())},{default:p(()=>[h("导出")]),_:1})]),s(v),s(_,{type:"textarea",rows:6,readonly:"",placeholder:"",modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=w=>l.value=w),style:{width:"100%"}},null,8,["modelValue"])])}}}),El=e("br",null,null,-1),Cl=E({__name:"ExportPDF",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(a,o)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,o)=>{const c=x("el-button");return n(),d("div",null,[e("span",null,$(r.wxid),1),El,s(c,{type:"primary",onClick:o[0]||(o[0]=y=>l())},{default:p(()=>[h("导出")]),_:1})])}}}),Tl=e("br",null,null,-1),Dl=E({__name:"ExportDOCX",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(a,o)=>{console.log(a)});const l=()=>{console.log("requestExport")};return(a,o)=>{const c=x("el-button");return n(),d("div",null,[e("span",null,$(r.wxid),1),Tl,s(c,{type:"primary",onClick:o[0]||(o[0]=y=>l())},{default:p(()=>[h("导出")]),_:1})])}}}),ql={id:"chat_export",style:{"background-color":"#d2d2fa",padding:"0"}},zl={style:{"background-color":"#d2d2fa",height:"calc(100vh - 65px)",display:"grid","place-items":"center"}},Rl={style:{"background-color":"#fff",width:"70%",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},jl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"导出与备份(未完待续...）"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),Hl={style:{"margin-top":"20px"}},Il=e("br",null,null,-1),Ol=e("br",null,null,-1),Ll={key:0},Nl=E({__name:"ChatExportMain",props:{wxid:{type:String,required:!0}},setup(t){const r=t;I(()=>r.wxid,(o,c)=>{console.log(o)});const l=m("");m("");const a={endb:{brief:"加密文件",detail:"导出的内容为微信加密数据库。可还原回微信,但会覆盖微信后续消息。(全程不解密，所以数据安全)"},dedb:{brief:"解密文件",detail:"导出的文件为解密后的sqlite数据库，并且会自动合并msg和media数据库为同一个，但是无法还原回微信。"},csv:{brief:"csv",detail:"只包含文本，但是可以用excel软件（wps，office）打开。"},json:{brief:"json",detail:"只包含文本，可用于数据分析，情感分析等方面。"},html:{brief:"html-开发中",detail:"主要用于浏览器可视化查看。"},pdf:{brief:"pdf-开发中",detail:"pdf版本。"},docx:{brief:"docx-开发中",detail:"docx版本。"}};return(o,c)=>{const y=x("el-option"),v=x("el-select"),_=x("el-divider"),w=x("el-main");return n(),d("div",ql,[s(w,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:p(()=>[e("div",zl,[e("div",Rl,[jl,e("div",Hl,[h(" 导出类型: "),s(v,{placeholder:"请选择导出类型",style:{width:"50%"},modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=f=>l.value=f)},{default:p(()=>[(n(),d(P,null,Z(a,(f,k)=>s(y,{label:f.brief,value:k,key:k},{default:p(()=>[h($(f.brief),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"]),Il,Ol,l.value?(n(),d("span",Ll,$(a[l.value].detail),1)):M("",!0)]),s(_),l.value=="endb"?(n(),V(ml,{key:0,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="dedb"?(n(),V(bl,{key:1,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="csv"?(n(),V(kl,{key:2,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="json"?(n(),V(Vl,{key:3,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="html"?(n(),V(Ml,{key:4,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="pdf"?(n(),V(Cl,{key:5,wxid:r.wxid},null,8,["wxid"])):M("",!0),l.value=="docx"?(n(),V(Dl,{key:6,wxid:r.wxid},null,8,["wxid"])):M("",!0)])])]),_:1})])}}}),Bl=E({__name:"ChatRecords",props:{wxid:{type:String,required:!0}},setup(t){const r=m(null),l=m(null);m(0);const a=m(0),o=()=>{A(()=>{if(r.value){const u=r.value.$el.children[0];u&&(u.scrollTop=u.scrollHeight,a.value=u.scrollHeight)}})},c=()=>{const u=r.value.$el.children[0];if(u){const U=a.value,R=u.scrollHeight-U;u.scrollTop=u.scrollTop+R,a.value=u.scrollHeight}};function y({scrollTop:u}){u===0&&l.value&&l.value.loadMore()}const v=t,_=m({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",wxid:"",msg_count:0}),w=async()=>{try{const u=await D.post("/api/wxid2user",{wxid:v.wxid});return _.value.account=u[v.wxid].account,_.value.describe=u[v.wxid].describe,_.value.headImgUrl=u[v.wxid].headImgUrl,_.value.nickname=u[v.wxid].nickname,_.value.remark=u[v.wxid].remark,_.value.wxid=v.wxid,u}catch(u){return console.error("Error fetching data wxid2user :",u),[]}},f=async()=>{try{const u=await D.post("/api/msg_count",{wxid:v.wxid});return _.value.msg_count=u[v.wxid],u}catch(u){return console.error("Error fetching data msg_count:",u),[]}};Y(()=>{f(),w(),A(()=>{o()})});const k=m(!1),q=u=>{k.value=u,k.value===!1&&(_.value.wxid="",w())};return I(()=>v.wxid,async(u,U)=>{u!==U&&(w(),f(),k.value=!1,A(()=>{o()}))}),(u,U)=>{const R=x("el-header"),H=x("el-scrollbar"),j=x("el-main"),g=x("el-container");return n(),V(g,null,{default:p(()=>[s(R,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:p(()=>[s(he,{userData:_.value,onExporting:q},null,8,["userData"])]),_:1}),s(j,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:p(()=>[s(H,{ref_key:"scrollbarRef",ref:r,onScroll:y},{default:p(()=>[k.value?(n(),V(Nl,{key:0,wxid:_.value.wxid},null,8,["wxid"])):(n(),V(_l,{key:1,ref_key:"chatRecordsMainRef",ref:l,userData:_.value,setScrollTop:o,updateScrollTop:c},null,8,["userData"]))]),_:1},512)]),_:1})]),_:1})}}}),Fl={class:"progress-bar"},Q=E({__name:"ProgressBar",props:{startORstop:{type:Number,required:!0}},setup(t){const r=m(0),l=m(500),a=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],o=m(new Date().getTime()),c=t,y=()=>{if(c.startORstop===1){r.value=100;return}o.value=new Date().getTime(),!(r.value>=99)&&(r.value>=80&&(l.value=l.value+50),r.value=r.value+1,setTimeout(y,l.value))};return y(),(v,_)=>{const w=x("el-progress");return n(),d("div",Fl,[s(w,{type:"dashboard",percentage:r.value,color:a},null,8,["percentage"])])}}}),Al={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},Pl={key:0},Wl={key:0},Kl={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},Gl=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),Yl={style:{"margin-top":"20px"}},Jl={style:{"margin-top":"20px"}},Xl={key:1},Ql={key:0},Zl={key:1,style:{"background-color":"#fff",width:"80%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},en=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),tn={style:{"margin-top":"20px"}},ln={key:0},nn=e("br",null,null,-1),on=e("br",null,null,-1),sn={key:1},an=e("br",null,null,-1),rn=e("br",null,null,-1),cn={key:2},dn=e("label",null,"密钥key(必填): ",-1),un=e("br",null,null,-1),_n={key:3},pn=e("label",null,"merge_all.db 文件路径(必填,非文件夹): ",-1),vn=e("br",null,null,-1),hn=e("label",null,"微信文件夹路径(必填): ",-1),mn=e("br",null,null,-1),fn=e("label",null,"微信原始id(必填): ",-1),yn=e("br",null,null,-1),xn={key:2},wn={key:3,style:{display:"flex","justify-content":"space-between"}},gn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},bn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"使用上次设置")],-1),$n={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},kn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),Sn={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},Vn=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),Un=E({__name:"IsAutoShow",emits:["isAutoShow"],setup(t,{emit:r}){const l=m(0),a=m(-1),o=m(""),c=m(!1),y=m([]),v=m(""),_=m(!1),w=m(!1),f=m("false"),k=m(""),q=m(""),u=m(""),U=m(""),R=r,H=async()=>{try{y.value=await D.post("/api/wxinfo"),y.value.length===1&&(j(y.value[0]),v.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(g,5e3))}catch(S){return console.error("Error fetching data:",S),[]}},j=async S=>{k.value="",q.value=S.filePath,u.value=S.key,U.value=S.wxid},g=()=>{if(q.value===""&&u.value===""&&U.value===""){console.log("请填写完整信息! ");return}if(_.value){console.log("正在解密...，请稍后再试！");return}T()},T=async()=>{if(_.value){console.log("正在解密中，请稍后再试！");return}_.value=!0;try{_.value=!0,a.value=0;let S={wx_path:q.value,key:u.value,my_wxid:U.value};const b=await D.post("/api/init_key",S);c.value=b.is_init,b.is_init&&(l.value=100),_.value=!1,R("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,_.value=!1,G.alert(S,"error",{confirmButtonText:"确认",callback:b=>{oe({type:"error",message:`action: ${b}`})}}),[]}_.value=!1},C=async()=>{try{let S={wx_path:q.value,merge_path:k.value,my_wxid:U.value};const b=await D.post("/api/init_nokey",S);c.value=b.is_init,b.is_init&&(l.value=100),_.value=!1,R("isAutoShow",b.is_init)}catch(S){return l.value=0,w.value=!0,_.value=!1,G.alert(S,"error",{confirmButtonText:"确认",callback:b=>{o.value=""}}),[]}_.value=!1},i=async()=>{try{let S={wx_path:q.value,merge_path:k.value,my_wxid:U.value};const b=await D.post("/api/init_last",S);c.value=b.is_init,b.is_init?(l.value=100,_.value=!1,R("isAutoShow",b.is_init)):(w.value=!0,_.value=!1,G.alert("未发现上次的设置数据！","error",{confirmButtonText:"确认",callback:W=>{o.value=""}})),_.value=!1}catch(S){return w.value=!0,_.value=!1,G.alert(S,"error",{confirmButtonText:"确认",callback:b=>{o.value=""}}),[]}_.value=!1};return I(o,S=>{S==="auto"?H():S==="custom"||S==="last"&&i()}),(S,b)=>{const W=x("el-button"),ee=x("el-divider"),K=x("el-input");return n(),d("div",Al,[o.value==="auto"?(n(),d("div",Pl,[_.value?(n(),d("div",Wl,[_.value?(n(),V(Q,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(n(),d("div",Kl,[Gl,e("div",Yl,[s(L(ne),{data:y.value,onCurrentChange:j,"highlight-current-row":"",style:{width:"100%"}},{default:p(()=>[s(L(N),{"min-width":30,prop:"pid",label:"进程id"}),s(L(N),{"min-width":40,prop:"version",label:"微信版本"}),s(L(N),{"min-width":40,prop:"account",label:"账号"}),s(L(N),{"min-width":40,prop:"name",label:"昵称"}),s(L(N),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",Jl,[s(W,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:g},{default:p(()=>[h("确定"+$(v.value),1)]),_:1})])]))])):o.value==="custom"?(n(),d("div",Xl,[_.value?(n(),d("div",Ql,[_.value?(n(),V(Q,{key:0,startORstop:a.value},null,8,["startORstop"])):M("",!0)])):(n(),d("div",Zl,[en,e("div",tn,[B(e("input",{type:"radio","onUpdate:modelValue":b[0]||(b[0]=z=>f.value=z),value:"true"},null,512),[[F,f.value]]),h(" 使用 KEY          "),B(e("input",{type:"radio","onUpdate:modelValue":b[1]||(b[1]=z=>f.value=z),value:"false"},null,512),[[F,f.value]]),h(" 不使用 KEY "),f.value=="false"?(n(),d("div",ln,[h(" 说明：1、表示数据库已解密并合并"),nn,h("2、合并后的数据库需要包含(MediaMSG,MSG,MicroMsg,OpenIMMsg)这些数据库合并的内容"),on])):M("",!0),f.value=="true"?(n(),d("div",sn,[h(" 说明：1、自动根据key解密微信文件夹下的数据库"),an,h("2、必须保证key正确，否则解密失败"),rn])):M("",!0),s(ee),f.value=="true"?(n(),d("div",cn,[dn,s(K,{placeholder:"密钥key (64位)",modelValue:u.value,"onUpdate:modelValue":b[2]||(b[2]=z=>u.value=z),style:{width:"80%"}},null,8,["modelValue"]),un])):M("",!0),f.value=="false"?(n(),d("div",_n,[pn,s(K,{placeholder:"(MediaMSG.db,MSG.db,MicroMsg.db,OpenIMMsg.db)合并后的数据库",modelValue:k.value,"onUpdate:modelValue":b[3]||(b[3]=z=>k.value=z),style:{width:"80%"}},null,8,["modelValue"]),vn])):M("",!0),hn,s(K,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:q.value,"onUpdate:modelValue":b[4]||(b[4]=z=>q.value=z),style:{width:"80%"}},null,8,["modelValue"]),mn,fn,s(K,{placeholder:"wxid_*******",modelValue:U.value,"onUpdate:modelValue":b[5]||(b[5]=z=>U.value=z),style:{width:"80%"}},null,8,["modelValue"]),yn,f.value=="true"?(n(),V(W,{key:4,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:T},{default:p(()=>[h(" 确定 ")]),_:1})):M("",!0),f.value=="false"?(n(),V(W,{key:5,style:{"margin-top":"10px",width:"100%"},type:"success",onClick:C},{default:p(()=>[h(" 确定 ")]),_:1})):M("",!0)])]))])):o.value==="last"?(n(),d("div",xn)):o.value===""?(n(),d("div",wn,[e("label",gn,[B(e("input",{type:"radio","onUpdate:modelValue":b[6]||(b[6]=z=>o.value=z),value:"last"},null,512),[[F,o.value]]),bn]),e("label",$n,[B(e("input",{type:"radio","onUpdate:modelValue":b[7]||(b[7]=z=>o.value=z),value:"auto"},null,512),[[F,o.value]]),kn]),e("label",Sn,[B(e("input",{type:"radio","onUpdate:modelValue":b[8]||(b[8]=z=>o.value=z),value:"custom"},null,512),[[F,o.value]]),Vn])])):M("",!0)])}}}),Mn={id:"chat_view",class:"common-layout"},En={key:0},Cn={key:1},Tn={key:0,style:{height:"calc(100vh)",width:"100%"}},Dn={key:1,style:{width:"100%",height:"100%"}},Hn=E({__name:"ChatView",setup(t){const r=m(!1),l=c=>{r.value=c},a=m(""),o=c=>{a.value=c};return(c,y)=>{const v=x("el-aside"),_=x("el-container");return n(),d("div",Mn,[r.value?(n(),d("div",Cn,[s(_,null,{default:p(()=>[s(v,{width:"auto",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:p(()=>[s(pe,{onWxid:o})]),_:1}),a.value!=""?(n(),d("div",Tn,[s(Bl,{wxid:a.value},null,8,["wxid"])])):(n(),d("div",Dn,[s(se)]))]),_:1})])):(n(),d("div",En,[s(Un,{onIsAutoShow:l})]))])}}});export{Hn as default};
