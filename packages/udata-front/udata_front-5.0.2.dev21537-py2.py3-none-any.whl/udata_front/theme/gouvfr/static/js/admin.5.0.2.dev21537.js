import{defineComponent as R,resolveComponent as I,openBlock as r,createElementBlock as _,createElementVNode as e,normalizeClass as N,createCommentVNode as k,createVNode as u,withCtx as g,createTextVNode as z,toDisplayString as s,unref as t,ref as w,onMounted as x,Fragment as O,renderList as U,createBlock as C,renderSlot as K,watchEffect as F,Teleport as Q,withModifiers as W,computed as ne,createApp as re}from"vue";import{_ as X,c as A,i as V,C as ie,b as le,q as de,s as ce,at as ue,e as Z,a as ee,j as _e,G as fe,a3 as me,au as he,av as J,aw as pe,ax as be,a9 as ve,ay as ge,az as ye,aA as $e,aB as we,aC as ke,d as ze,aj as Me,af as Re,am as Y,an as Ce,aa as Ae,ao as qe,U as Ie,aD as Se,aE as Te,ap as Ve,aq as xe,ar as Be}from"./sentry.5.0.2.dev21537.js";import"./_commonjsHelpers.5.0.2.dev21537.js";function Bs(){import.meta.url,import("_").catch(()=>1);async function*b(){}}const Oe={class:"fr-sidemenu__item"},He=["innerHTML"],Pe=R({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(b){return(o,a)=>{const l=I("router-link");return r(),_("li",Oe,[e("div",{class:N([{"fr-icon-svg fr-icon--sm":o.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[o.iconHtml?(r(),_("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:o.iconHtml},null,8,He)):o.icon?(r(),_("div",{key:1,class:N([o.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):k("",!0),u(l,{to:o.to},{default:g(()=>[z(s(o.label),1)]),_:1},8,["to"])],2)])}}});const H=X(Pe,[["__scopeId","data-v-6240fbee"]]),Ee='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Le=["aria-expanded","aria-controls","aria-current"],je={class:"logo logo--sm"},De={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Ne=["id"],Ue={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},We=R({__name:"AdminSidebarOrganizationMenu",props:{organization:{},isOpened:{type:Boolean}},setup(b){const{t:o}=A(),a=V("organization-menu");return(l,i)=>(r(),_("li",{class:N(["fr-sidemenu__item",{"fr-sidemenu__item--active":l.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":l.isOpened,"aria-controls":t(a),"aria-current":l.isOpened},[e("div",je,[u(ie,{type:"organization",src:l.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",De,s(l.organization.name),1)],8,Le),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(a)},[e("ul",Ue,[u(H,{iconHtml:t(Ee),label:t(o)("Datasets"),to:{name:"organization-datasets",params:{oid:l.organization.id}}},null,8,["iconHtml","label","to"]),u(H,{icon:"fr-icon-line-chart-line",label:t(o)("Reuses"),to:{name:"organization-reuses",params:{oid:l.organization.id}}},null,8,["label","to"]),u(H,{icon:"fr-icon-parent-line",label:t(o)("Members"),to:{name:"organization-members",params:{oid:l.organization.id}}},null,8,["label","to"])])],8,Ne)],2))}});const Ye=X(We,[["__scopeId","data-v-88e26365"]]);let D;function P(){return le(),D||(D=de.get(ce("me/")).then(b=>b.data))}const Fe={class:"fr-container--fluid h-100"},Ze={class:"fr-grid-row h-100 bg-grey-50"},Ge={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Je=["aria-label"],Ke={class:"fr-sidemenu__inner"},Qe=["aria-controls"],Xe=["id"],et={class:"fr-sidemenu__list"},tt={class:"fr-sidemenu__item"},st=["aria-controls"],ot={class:"fr-mx-1v"},at=["id"],nt={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},rt=R({__name:"Admin",setup(b){const{t:o}=A(),a=ue(),l=V("menu"),i=V("profil-submenu"),d=w(null),f=w(null);function v(h){return h===f.value}return x(async()=>{d.value=await P(),d.value.organizations.length>0&&(a.params.oid?f.value=a.params.oid:f.value=d.value.organizations[0].id)}),(h,y)=>{const M=I("router-view");return r(),_("div",Fe,[e("div",Ze,[e("div",Ge,[e("nav",{class:"fr-sidemenu","aria-label":t(o)("Administration menu")},[e("div",Ke,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(l),"aria-expanded":"false"},s(t(o)("Open menu")),9,Qe),e("div",{class:"fr-collapse",id:t(l)},[e("ul",et,[e("li",tt,[e("button",{class:"fr-sidemenu__btn border-bottom border-default-grey","aria-expanded":"false","aria-controls":t(i)},[u(Z,{user:t(ee),size:24,rounded:!0},null,8,["user"]),e("p",ot,s(t(o)("My Profil")),1)],8,st),e("div",{class:"fr-collapse",id:t(i)},[u(H,{icon:"fr-icon-account-circle-line",label:t(o)("Me"),to:"/me"},null,8,["label"])],8,at)]),d.value?(r(!0),_(O,{key:0},U(d.value.organizations,m=>(r(),C(Ye,{organization:m,"is-opened":v(m.id)},null,8,["organization","is-opened"]))),256)):k("",!0)])],8,Xe)])],8,Je)]),e("div",nt,[(r(),C(M,{key:t(a).fullPath}))])])])}}});const it=["aria-label"],lt={class:"fr-breadcrumb__list"},E={__name:"Breadcrumb",setup(b){const{t:o}=A();return(a,l)=>(r(),_("nav",{rol:"navigation","aria-label":t(o)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",lt,[K(a.$slots,"default")])],8,it))}},dt={class:"fr-container--fluid"},ct={key:0},ut={class:"fr-breadcrumb__link","aria-current":"page"},_t={class:"fr-alert fr-alert--info"},ft={class:"fr-alert__title"},mt=R({__name:"Datasets",props:{oid:{}},setup(b){const{t:o}=A(),a=b,l="/admin/organization/".concat(a.oid,"/"),i=w(null),d=w(null);return x(async()=>i.value=await P()),F(()=>{var f,v;d.value=(v=(f=i.value)==null?void 0:f.organizations.find(h=>h.id===a.oid))!=null?v:null}),(f,v)=>{const h=I("router-link");return r(),_("div",dt,[u(E,null,{default:g(()=>[e("li",null,[u(h,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(t(o)("Administration")),1)]),_:1})]),d.value?(r(),_("li",ct,[u(h,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(d.value.name),1)]),_:1})])):k("",!0),e("li",null,[e("a",ut,s(t(o)("Datasets")),1)])]),_:1}),e("div",_t,[e("h3",ft,s(t(o)("This is a WIP page")),1),e("p",null,[e("a",{href:l},s(t(o)("You can manage your datasets on the current admin.")),1)])])])}}}),ht={class:"fr-container--fluid"},pt={key:0},bt={class:"fr-breadcrumb__link","aria-current":"page"},vt={class:"fr-alert fr-alert--info"},gt={class:"fr-alert__title"},yt=R({__name:"Reuses",props:{oid:{}},setup(b){const{t:o}=A(),a=b,l="/admin/organization/".concat(a.oid,"/"),i=w(null),d=w(null);return x(async()=>i.value=await P()),F(()=>{var f,v;d.value=(v=(f=i.value)==null?void 0:f.organizations.find(h=>h.id===a.oid))!=null?v:null}),(f,v)=>{const h=I("router-link");return r(),_("div",ht,[u(E,null,{default:g(()=>[e("li",null,[u(h,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(t(o)("Administration")),1)]),_:1})]),d.value?(r(),_("li",pt,[u(h,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(d.value.name),1)]),_:1})])):k("",!0),e("li",null,[e("a",bt,s(t(o)("Reuses")),1)])]),_:1}),e("div",vt,[e("h3",gt,s(t(o)("This is a WIP page")),1),e("p",null,[e("a",{href:l},s(t(o)("You can manage your reuses on the current admin.")),1)])])])}}}),$t={class:"fr-container--fluid"},wt={class:"fr-breadcrumb__link","aria-current":"page"},kt={key:0,class:"fr-h1"},zt={class:"fr-alert fr-alert--info"},Mt={class:"fr-alert__title"},Rt={href:"/admin/me/"},Ct=R({__name:"Me",setup(b){const{t:o}=A(),a=w(null);return x(async()=>a.value=await P()),(l,i)=>{const d=I("router-link");return r(),_("div",$t,[u(E,null,{default:g(()=>[e("li",null,[u(d,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(t(o)("Administration")),1)]),_:1})]),e("li",null,[e("a",wt,s(t(o)("Me")),1)])]),_:1}),a.value?(r(),_("h1",kt,s(a.value.first_name)+" "+s(a.value.last_name),1)):k("",!0),e("div",zt,[e("h3",Mt,s(t(o)("This is a WIP page")),1),e("p",null,[e("a",Rt,s(t(o)("You can edit your profil on the current admin.")),1)])])])}}}),At={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},qt=R({__name:"AdminDangerZone",setup(b){return(o,a)=>(r(),C(t(_e),{color:"error",type:"secondary",weight:"regular"},{default:g(()=>[e("div",At,[K(o.$slots,"default")])]),_:3}))}}),It={class:"fr-mt-n9v fr-mb-2w"},St={class:"fr-badge fr-badge--info fr-badge--no-icon"},Tt=e("span",{class:"fr-icon-user-add-line","aria-hidden":"true"},null,-1),Vt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},xt={class:"fr-col"},Bt={class:"fr-grid-row fr-grid-row--middle"},Ot={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},Ht={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Pt=["disabled"],Et=["disabled","aria-controls"],Lt=["aria-labelledby","id"],jt={class:"fr-container fr-container--fluid fr-container-md"},Dt={class:"fr-grid-row fr-grid-row--center"},Nt={class:"fr-col-12 fr-col-md-8"},Ut={class:"fr-modal__body"},Wt={class:"fr-modal__header"},Yt=["title","aria-controls"],Ft={class:"fr-modal__content"},Zt=["id"],Gt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Jt={class:"fr-col-auto"},Kt=["disabled"],Qt={class:"fr-col-auto"},Xt=["disabled"],es=R({__name:"MembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(b,{emit:o}){const a=b,l=o,{t:i}=A(),d=w(""),f=V("modal"),v=V("modalTitle");function h(){const m=document.getElementById(f);globalThis.dsfr(m).modal.conceal()}function y(){l("refuse",a.request.id,d.value),h()}function M(){d.value="",h()}return(m,q)=>{const L=I("MembershipRequest",!0);return r(),C(fe,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:g(()=>[e("div",It,[e("p",St,[Tt,z(" "+s(t(i)("Membership Request")),1)])]),e("div",Vt,[e("div",xt,[e("div",Bt,[u(Z,{class:"fr-mr-1v",user:m.request.user,rounded:!0,size:24},null,8,["user"]),z(" "+s(t(i)("{fullName} asks to join the organization.",{fullName:m.request.user.first_name+" "+m.request.user.last_name})),1)]),e("div",Ot,s(m.request.comment),1)]),m.showActions?(r(),_("div",Ht,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:q[0]||(q[0]=B=>m.$emit("accept",m.request.id)),disabled:m.loading,"data-testid":"accept"},s(t(i)("Accept request")),9,Pt),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:m.loading,"data-fr-opened":"false","aria-controls":t(f),"data-testid":"refuse"},s(t(i)("Refuse")),9,Et),(r(),C(Q,{to:"body"},[e("dialog",{"aria-labelledby":t(v),role:"dialog",id:t(f),class:"fr-modal","data-testid":"modal"},[e("div",jt,[e("div",Dt,[e("div",Nt,[e("div",Ut,[e("div",Wt,[e("button",{class:"fr-btn--close fr-btn",title:t(i)("Close the modal dialog"),"aria-controls":t(f),onClick:W(M,["prevent"])},s(t(i)("Close")),9,Yt)]),e("div",Ft,[e("h1",{id:t(v),class:"fr-modal__title fr-mb-2w"},s(t(i)("Refuse membership request")),9,Zt),u(L,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:m.oid,request:m.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:W(y,["prevent"]),onReset:M},[u(me,{label:t(i)("You can provide the refusal reason:"),modelValue:d.value,"onUpdate:modelValue":q[1]||(q[1]=B=>d.value=B),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",Gt,[e("div",Jt,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:m.loading,"data-testid":"cancel-modal-button"},s(t(i)("Cancel")),9,Kt)]),e("div",Qt,[e("button",{class:"fr-btn",type:"submit",disabled:m.loading,"data-testid":"refuse-modal-button"},s(t(i)("Refuse request")),9,Xt)])])],32)])])])])])],8,Lt)]))])):k("",!0)])]),_:1})}}}),ts={key:0},ss=e("li",null,null,-1),os={class:"fr-h1 fr-mb-2w"},as={class:"subtitle subtitle--uppercase"},ns={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},rs={class:"fr-table fr-table--layout-fixed"},is={scope:"col"},ls={scope:"col"},ds={key:0,scope:"col"},cs={class:"fr-badge"},us={key:0},_s=["aria-controls"],fs=["aria-labelledby","id"],ms={class:"fr-container fr-container--fluid fr-container-md"},hs={class:"fr-grid-row fr-grid-row--center"},ps={class:"fr-col-12 fr-col-md-8"},bs={class:"fr-modal__body"},vs={class:"fr-modal__header"},gs=["title","aria-controls"],ys={class:"fr-modal__content"},$s=["id"],ws={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},ks=["onSubmit"],zs={class:"fr-col"},Ms={class:"fr-col-auto"},Rs=["disabled"],Cs={class:"fr-col"},As={class:"fr-m-0 text-grey-500"},qs={class:"fr-m-0 fr-text--xs text-default-error"},Is={class:"fr-col-auto"},Ss=["disabled","onClick"],Ts=R({__name:"Members",props:{oid:{}},setup(b){const o=b,{t:a}=A(),{toast:l}=ze(),i=w([]),d=ne(()=>he||h.value.some(n=>{var p;return n.user.id===((p=ee)==null?void 0:p.id)&&n.role==="admin"})),f=w([]),v={name:"SomeName"},h=w([]),y=w(!1);function M(n){return"fr-modal-user-"+n}function m(n){return"fr-modal-title-user-"+n}function q(n){const p=document.getElementById(M(n));globalThis.dsfr(p).modal.conceal()}async function L(n){if(!n.newRole){q(n.user.id);return}try{y.value=!0,await ge(o.oid,n.user.id,n.newRole),T(),q(n.user.id)}catch(p){l.error(a("An error occurred while updating the member role."))}finally{y.value=!1}}async function B(n){try{y.value=!0,await ye(o.oid,n.user.id),T()}catch(p){l.error(a("An error occurred while removing this member."))}finally{y.value=!1}}function te(n){var p,$;return($=(p=f.value.find(c=>c.value===n))==null?void 0:p.label)!=null?$:n}function se(n){return f.value.map(p=>{const $={...p};return $.value===n&&($.selected=!0),$})}async function T(){const n=await $e(o.oid);h.value=n.members}async function G(){const n=await J(o.oid);i.value=n}async function oe(n){y.value=!0;const p=[];try{await we(o.oid,n),p.push(G()),p.push(T())}catch($){l.error(a("An error occurred while accepting this membership."))}finally{Promise.all(p).finally(()=>y.value=!1)}}async function ae(n,p){y.value=!0;const $=[];try{await ke(o.oid,n,p),$.push(G()),$.push(T())}catch(c){l.error(a("An error occurred while refusing this membership."))}finally{Promise.all($).finally(()=>y.value=!1)}}return F(()=>{d.value&&J(o.oid).then(n=>i.value=n)}),x(()=>{pe().then(be).then(n=>f.value=n),T()}),(n,p)=>{const $=I("router-link");return r(),_("div",null,[u(E,null,{default:g(()=>[e("li",null,[u($,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(t(a)("Administration")),1)]),_:1})]),v?(r(),_("li",ts,[u($,{class:"fr-breadcrumb__link",to:"/"},{default:g(()=>[z(s(v.name),1)]),_:1})])):k("",!0),ss]),_:1}),e("h1",os,s(t(a)("Members")),1),i.value.length?(r(),_(O,{key:0},[e("h2",as,s(t(a)("{n} requests",{n:i.value.length})),1),(r(!0),_(O,null,U(i.value,c=>(r(),C(es,{class:"fr-mb-4w",key:c.id,loading:y.value,oid:n.oid,request:c,"show-actions":!0,onAccept:oe,onRefuse:ae},null,8,["loading","oid","request"]))),128))],64)):k("",!0),e("h2",ns,s(t(a)("{n} members",{n:h.value.length})),1),e("div",rs,[e("table",null,[e("thead",null,[e("tr",null,[e("th",is,s(t(a)("Members")),1),e("th",ls,s(t(a)("Status")),1),d.value?(r(),_("th",ds,s(t(a)("Action")),1)):k("",!0)])]),e("tbody",null,[(r(!0),_(O,null,U(h.value,c=>(r(),_("tr",{key:c.user.id},[e("td",null,s(c.user.first_name)+" "+s(c.user.last_name),1),e("td",null,[e("p",cs,s(te(c.role)),1)]),d.value?(r(),_("td",us,[e("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":M(c.user.id)},s(t(a)("Edit")),9,_s),(r(),C(Q,{to:"body"},[e("dialog",{"aria-labelledby":m(c.user.id),role:"dialog",id:M(c.user.id),class:"fr-modal"},[e("div",ms,[e("div",hs,[e("div",ps,[e("div",bs,[e("div",vs,[e("button",{class:"fr-btn--close fr-btn",title:t(a)("Close the modal dialog"),"aria-controls":M(c.user.id)},s(t(a)("Close")),9,gs)]),e("div",ys,[e("h1",{id:m(c.user.id),class:"fr-modal__title fr-mb-2w"},s(t(a)("Edit member")),9,$s),e("p",ws,[u(Z,{class:"fr-mr-1v",user:c.user,rounded:!0,size:24},null,8,["user"]),z(" "+s(c.user.first_name)+" "+s(c.user.last_name),1)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:W(j=>L(c),["prevent"])},[e("div",zs,[f.value.length>0?(r(),C(ve,{key:0,label:t(a)("Role of the member"),"model-value":c.role,"onUpdate:modelValue":j=>c.newRole=j,options:se(c.role)},null,8,["label","model-value","onUpdate:modelValue","options"])):k("",!0)]),e("div",Ms,[e("button",{class:"fr-btn",type:"submit",disabled:y.value},s(t(a)("Validate")),9,Rs)])],40,ks),u(qt,{class:"fr-mt-2w"},{default:g(()=>[e("div",Cs,[e("p",As,s(t(a)("Remove member from the organization")),1),e("p",qs,s(t(a)("Be careful, this action can't be reverse.")),1)]),e("div",Is,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:y.value,onClick:j=>B(c)},s(t(a)("Remove member")),9,Ss)])]),_:2},1024)])])])])])],8,fs)]))])):k("",!0)]))),128))])])])])}}});Me({admin_root:Re,default_lang:Y.global.locale.value,explorable_resources:Ce,only_locales:Y.global.locale.value,schema_documentation_url:Ae,schema_validata_url:qe,show_copy_resource_permalink:!0,title:Ie});const Vs=[{path:"/me",component:Ct},{path:"/organizations/:oid",children:[{path:"datasets",component:mt,props:!0,name:"organization-datasets"},{path:"reuses",component:yt,props:!0,name:"organization-reuses"},{path:"members",component:Ts,props:!0,name:"organization-members"}]}],xs=Se({history:Te(),routes:Vs}),S=re(rt);Ve(S);S.use(xe);S.use(Be);S.use(Y);S.use(xs);S.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{Bs as __vite_legacy_guard};
