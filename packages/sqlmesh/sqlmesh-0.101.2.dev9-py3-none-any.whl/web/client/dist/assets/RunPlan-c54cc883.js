import{r as p,v as q,D as z,y as _,w as de,x as w,R as X,z as me,A as se,B as O,X as B,I as J,F as ie,G as fe,H as pe,J as K,K as xe,T as ve,M as y,Q as he,U as H,V as ge,W as Z,Y as oe,Z as ye,u as le,$ as C,a as I,n as be,a0 as Ie,a1 as we,j as t,a2 as L,a3 as F,c as M,o as $,S as Ee,e as k,a4 as je,a5 as Pe,d as R,a6 as ce,a7 as ee,a8 as V,a9 as Se,aa as Ne,E as Re}from"./index-45e2979d.js";import{C as Me,I as te}from"./SearchList-14ae8126.js";import{F as ke,E as j,C as De,P as ne}from"./PlanChangePreview-53bcd1d9.js";import{c as Ce,d as Ae,e as S,x as Te}from"./context-7d3868a2.js";import{s as Fe,k as ae}from"./popover-fc660b3f.js";import{M as $e}from"./disclosure-4af2941a.js";import"./ModelLineage-f83a4b5f.js";import"./PlusIcon-257d00e1.js";import"./_commonjs-dynamic-modules-302442b1.js";function Oe({title:e,titleId:a,...r},s){return p.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":a},r),e?p.createElement("title",{id:a},e):null,p.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const Le=p.forwardRef(Oe),ze=Le;var _e=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(_e||{}),Be=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Be||{}),Qe=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Qe||{});function G(e,a=r=>r){let r=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,s=ye(a(e.items.slice()),d=>d.dataRef.current.domRef.current),i=r?s.indexOf(r):null;return i===-1&&(i=null),{items:s,activeItemIndex:i}}let Ue={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,a)=>{var r;let s=G(e),i=Te(a,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:d=>d.id,resolveDisabled:d=>d.dataRef.current.disabled});return{...e,...s,searchQuery:"",activeItemIndex:i,activationTrigger:(r=a.trigger)!=null?r:1}},3:(e,a)=>{let r=e.searchQuery!==""?0:1,s=e.searchQuery+a.value.toLowerCase(),i=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+r).concat(e.items.slice(0,e.activeItemIndex+r)):e.items).find(o=>{var n;return((n=o.dataRef.current.textValue)==null?void 0:n.startsWith(s))&&!o.dataRef.current.disabled}),d=i?e.items.indexOf(i):-1;return d===-1||d===e.activeItemIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeItemIndex:d,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,a)=>{let r=G(e,s=>[...s,{id:a.id,dataRef:a.dataRef}]);return{...e,...r}},6:(e,a)=>{let r=G(e,s=>{let i=s.findIndex(d=>d.id===a.id);return i!==-1&&s.splice(i,1),s});return{...e,...r,activationTrigger:1}}},W=p.createContext(null);W.displayName="MenuContext";function Q(e){let a=p.useContext(W);if(a===null){let r=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Q),r}return a}function Ke(e,a){return se(a.type,Ue,e,a)}let Ve=p.Fragment;function Ge(e,a){let{__demoMode:r=!1,...s}=e,i=p.useReducer(Ke,{__demoMode:r,menuState:r?0:1,buttonRef:p.createRef(),itemsRef:p.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:d,itemsRef:o,buttonRef:n},u]=i,m=_(a);de([n,o],(P,N)=>{var v;u({type:1}),xe(N,ve.Loose)||(P.preventDefault(),(v=n.current)==null||v.focus())},d===0);let h=w(()=>{u({type:1})}),c=p.useMemo(()=>({open:d===0,close:h}),[d,h]),g={ref:m};return X.createElement(W.Provider,{value:i},X.createElement(me,{value:se(d,{0:O.Open,1:O.Closed})},B({ourProps:g,theirProps:s,slot:c,defaultTag:Ve,name:"Menu"})))}let He="button";function Je(e,a){var r;let s=J(),{id:i=`headlessui-menu-button-${s}`,...d}=e,[o,n]=Q("Menu.Button"),u=_(o.buttonRef,a),m=ie(),h=w(v=>{switch(v.key){case y.Space:case y.Enter:case y.ArrowDown:v.preventDefault(),v.stopPropagation(),n({type:0}),m.nextFrame(()=>n({type:2,focus:S.First}));break;case y.ArrowUp:v.preventDefault(),v.stopPropagation(),n({type:0}),m.nextFrame(()=>n({type:2,focus:S.Last}));break}}),c=w(v=>{switch(v.key){case y.Space:v.preventDefault();break}}),g=w(v=>{if(he(v.currentTarget))return v.preventDefault();e.disabled||(o.menuState===0?(n({type:1}),m.nextFrame(()=>{var x;return(x=o.buttonRef.current)==null?void 0:x.focus({preventScroll:!0})})):(v.preventDefault(),n({type:0})))}),P=p.useMemo(()=>({open:o.menuState===0}),[o]),N={ref:u,id:i,type:Fe(e,o.buttonRef),"aria-haspopup":"menu","aria-controls":(r=o.itemsRef.current)==null?void 0:r.id,"aria-expanded":o.menuState===0,onKeyDown:h,onKeyUp:c,onClick:g};return B({ourProps:N,theirProps:d,slot:P,defaultTag:He,name:"Menu.Button"})}let We="div",Ye=q.RenderStrategy|q.Static;function qe(e,a){var r,s;let i=J(),{id:d=`headlessui-menu-items-${i}`,...o}=e,[n,u]=Q("Menu.Items"),m=_(n.itemsRef,a),h=fe(n.itemsRef),c=ie(),g=pe(),P=(()=>g!==null?(g&O.Open)===O.Open:n.menuState===0)();p.useEffect(()=>{let l=n.itemsRef.current;l&&n.menuState===0&&l!==(h==null?void 0:h.activeElement)&&l.focus({preventScroll:!0})},[n.menuState,n.itemsRef,h]),ke({container:n.itemsRef.current,enabled:n.menuState===0,accept(l){return l.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:l.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(l){l.setAttribute("role","none")}});let N=w(l=>{var E,A;switch(c.dispose(),l.key){case y.Space:if(n.searchQuery!=="")return l.preventDefault(),l.stopPropagation(),u({type:3,value:l.key});case y.Enter:if(l.preventDefault(),l.stopPropagation(),u({type:1}),n.activeItemIndex!==null){let{dataRef:b}=n.items[n.activeItemIndex];(A=(E=b.current)==null?void 0:E.domRef.current)==null||A.click()}oe(n.buttonRef.current);break;case y.ArrowDown:return l.preventDefault(),l.stopPropagation(),u({type:2,focus:S.Next});case y.ArrowUp:return l.preventDefault(),l.stopPropagation(),u({type:2,focus:S.Previous});case y.Home:case y.PageUp:return l.preventDefault(),l.stopPropagation(),u({type:2,focus:S.First});case y.End:case y.PageDown:return l.preventDefault(),l.stopPropagation(),u({type:2,focus:S.Last});case y.Escape:l.preventDefault(),l.stopPropagation(),u({type:1}),H().nextFrame(()=>{var b;return(b=n.buttonRef.current)==null?void 0:b.focus({preventScroll:!0})});break;case y.Tab:l.preventDefault(),l.stopPropagation(),u({type:1}),H().nextFrame(()=>{ge(n.buttonRef.current,l.shiftKey?Z.Previous:Z.Next)});break;default:l.key.length===1&&(u({type:3,value:l.key}),c.setTimeout(()=>u({type:4}),350));break}}),v=w(l=>{switch(l.key){case y.Space:l.preventDefault();break}}),x=p.useMemo(()=>({open:n.menuState===0}),[n]),f={"aria-activedescendant":n.activeItemIndex===null||(r=n.items[n.activeItemIndex])==null?void 0:r.id,"aria-labelledby":(s=n.buttonRef.current)==null?void 0:s.id,id:d,onKeyDown:N,onKeyUp:v,role:"menu",tabIndex:0,ref:m};return B({ourProps:f,theirProps:o,slot:x,defaultTag:We,features:Ye,visible:P,name:"Menu.Items"})}let Xe=p.Fragment;function Ze(e,a){let r=J(),{id:s=`headlessui-menu-item-${r}`,disabled:i=!1,...d}=e,[o,n]=Q("Menu.Item"),u=o.activeItemIndex!==null?o.items[o.activeItemIndex].id===s:!1,m=p.useRef(null),h=_(a,m);K(()=>{if(o.__demoMode||o.menuState!==0||!u||o.activationTrigger===0)return;let b=H();return b.requestAnimationFrame(()=>{var U,Y;(Y=(U=m.current)==null?void 0:U.scrollIntoView)==null||Y.call(U,{block:"nearest"})}),b.dispose},[o.__demoMode,m,u,o.menuState,o.activationTrigger,o.activeItemIndex]);let c=Ce(m),g=p.useRef({disabled:i,domRef:m,get textValue(){return c()}});K(()=>{g.current.disabled=i},[g,i]),K(()=>(n({type:5,id:s,dataRef:g}),()=>n({type:6,id:s})),[g,s]);let P=w(()=>{n({type:1})}),N=w(b=>{if(i)return b.preventDefault();n({type:1}),oe(o.buttonRef.current)}),v=w(()=>{if(i)return n({type:2,focus:S.Nothing});n({type:2,focus:S.Specific,id:s})}),x=Ae(),f=w(b=>x.update(b)),l=w(b=>{x.wasMoved(b)&&(i||u||n({type:2,focus:S.Specific,id:s,trigger:0}))}),E=w(b=>{x.wasMoved(b)&&(i||u&&n({type:2,focus:S.Nothing}))}),A=p.useMemo(()=>({active:u,disabled:i,close:P}),[u,i,P]);return B({ourProps:{id:s,ref:h,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,disabled:void 0,onClick:N,onFocus:v,onPointerEnter:f,onMouseEnter:f,onPointerMove:l,onMouseMove:l,onPointerLeave:E,onMouseLeave:E},theirProps:d,slot:A,defaultTag:Xe,name:"Menu.Item"})}let et=z(Ge),tt=z(Je),nt=z(qe),at=z(Ze),T=Object.assign(et,{Button:tt,Items:nt,Item:at});function xt(){const{setIsPlanOpen:e}=le(),a=C(c=>c.planOverview),r=C(c=>c.planAction),s=C(c=>c.setPlanAction),i=I(c=>c.addConfirmation),d=I(c=>c.setShowConfirmation),o=I(c=>c.environment),n=I(c=>c.environments),[u,m]=p.useState(!1);p.useEffect(()=>{u&&(h(),m(!1))},[u]);function h(){be(a.skipTests)&&s(new Ie({value:we.Run})),e(!0)}return t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(L,{className:"mx-0 rounded-none rounded-l-lg border-r",variant:F.Alternative,size:M.sm,onClick:c=>{c.stopPropagation(),r.isProcessing?e(!0):o.isDefault&&$(o.isInitial)?i({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${o.name}`,noText:"No, Cancel",action(){h()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${n.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[n.size>1&&t.jsx(re,{className:"mr-2",side:"left",environment:o,showAddEnvironment:!1,onSelect:()=>{m(!0),d(!1)},size:M.md,disabled:r.isProcessing}),t.jsx(ue,{className:"w-full",size:M.md,onAdd:()=>{m(!0),d(!1)}})]})]})}):h()},children:[r.isProcessing&&t.jsx(Ee,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:r.displayStatus})]}),t.jsx(re,{className:"rounded-none rounded-r-lg border-l mx-0",environment:o,disabled:r.isProcessing||o.isDefaultInitial&&o.isLocal})]}),t.jsx(rt,{}),t.jsx(st,{})]})}function rt(){const e=I(r=>r.environment),a=C(r=>r.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[e.isLocal&&t.jsx("span",{title:"New",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),e.isSynchronized&&a.isLatest&&t.jsx("span",{title:"Latest",className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:"Latest"})]})}function st(){var a,r,s,i,d,o,n,u;const e=C(m=>m.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[k((a=e.backfills)==null?void 0:a.models)&&t.jsx(D,{headline:"Backfills",type:j.Default,changes:((r=e.backfills)==null?void 0:r.models.map(({model_name:m,view_name:h})=>m??h))??[]}),k(e.added)&&t.jsx(D,{headline:"Added Models",type:j.Add,changes:e.added??[]}),k((s=e.modified)==null?void 0:s.direct)&&t.jsx(D,{headline:"Direct Changes",type:j.Direct,changes:((i=e.modified)==null?void 0:i.direct.map(({model_name:m})=>m))??[]}),k((d=e.modified)==null?void 0:d.indirect)&&t.jsx(D,{headline:"Indirectly Modified",type:j.Indirect,changes:((o=e.modified)==null?void 0:o.indirect.map(({model_name:m})=>m))??[]}),k((n=e.modified)==null?void 0:n.metadata)&&t.jsx(D,{headline:"Metadata Changes",type:j.Default,changes:((u=e.modified)==null?void 0:u.metadata)??[]}),k(e.removed)&&t.jsx(D,{headline:"Removed Models",type:j.Remove,changes:e.removed??[]})]})}function re({onSelect:e,environment:a,disabled:r,side:s=V.Right,className:i,showAddEnvironment:d=!0,size:o=M.sm}){const{addError:n}=le(),u=I(x=>x.environments),m=I(x=>x.pinnedEnvironments),h=I(x=>x.defaultEnvironment),c=I(x=>x.setEnvironment),g=I(x=>x.removeLocalEnvironment),{refetch:P}=je(a.name,{planOptions:{skip_tests:!0,include_unmodified:!0}}),N=Pe(T.Button);function v(x){Ne(x.name).then(()=>{g(x)}).catch(f=>{n(Re.Environments,f)})}return t.jsx(T,{children:({close:x})=>t.jsxs(t.Fragment,{children:[t.jsxs(N,{variant:F.Alternative,size:o,disabled:r,className:R(i),children:[t.jsx("span",{className:R("block overflow-hidden truncate",(a.isLocal||r)&&"text-neutral-500",a.isSynchronized&&"text-primary-500"),children:a.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Me,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(ce,{as:p.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:R("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",s===V.Left&&"left-0",s===V.Right&&"right-0"),children:[t.jsxs(T.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(u).map(f=>t.jsx(T.Item,{children:({active:l})=>t.jsxs("div",{onClick:E=>{E.stopPropagation(),f.isSynchronized&&P(),c(f),e==null||e()},className:R("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",l&&"bg-primary-10",f===a&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(De,{className:R("w-4 h-4 text-primary-500 mt-1.5",l&&"opacity-10",f!==a&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:R("block truncate ml-2",f.isSynchronized&&"text-primary-500"),children:f.name}),t.jsxs("small",{className:"block ml-2",children:["(",f.type,")"]})]}),f.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Main Environment"})}),h===f&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[f.isPinned&&t.jsx(ze,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),f.isLocal&&$(f.isPinned)&&f!==a&&t.jsx(L,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:M.xs,variant:F.Neutral,onClick:E=>{E.stopPropagation(),g(f)},children:t.jsx($e,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),$(f.isDefault)&&f!==a&&f.isSynchronized&&$(m.includes(f))&&t.jsx(L,{className:"!px-2 !my-0",size:M.xs,variant:F.Danger,onClick:E=>{E.stopPropagation(),v(f)},children:"Delete"})]})]})},f.name)),d&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(ue,{onAdd:x,className:"mt-2 px-2"})]})]}),t.jsx(ee,{})]})})]})})}function ue({onAdd:e,className:a,label:r="Add",size:s=M.sm}){const i=I(c=>c.getNextEnvironment),d=I(c=>c.isExistingEnvironment),o=I(c=>c.addLocalEnvironment),[n,u]=p.useState(""),[m,h]=p.useState(i().name);return t.jsxs("div",{className:R("flex w-full items-center",a),children:[t.jsx(te,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:s,children:({className:c})=>t.jsx(te.Textfield,{className:R(c,"w-full"),placeholder:"Environment",value:n,onInput:g=>{g.stopPropagation(),u(g.target.value)}})}),t.jsx(L,{className:"my-0 mx-0 font-bold",size:s,disabled:Se(n)||d(n),onClick:c=>{c.stopPropagation(),o(n,m),u(""),h(i().name),e==null||e()},children:r})]})}function D({headline:e,type:a,changes:r}){const[s,i]=p.useState(!1);return t.jsx(ae,{onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:R("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",a===j.Add&&"bg-success-500 border-success-500",a===j.Remove&&"bg-danger-500 border-danger-500",a===j.Direct&&"bg-secondary-500 border-secondary-500",a===j.Indirect&&"bg-warning-500 border-warning-500",a===j.Default&&"bg-neutral-500 border-neutral-500"),children:r.length}),t.jsx(ce,{show:s,as:p.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(ae.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(ne,{headline:e,type:a,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto ",children:t.jsx(ne.Default,{type:a,changes:r})})})})]})})}export{xt as default};
