"use strict";(self.webpackChunkjupyterlab_pioneer=self.webpackChunkjupyterlab_pioneer||[]).push([[256],{256:(e,n,t)=>{t.r(n),t.d(n,{IJupyterLabPioneer:()=>j,default:()=>D});var o=t(611),i=t(762),a=t(930),l=t(759),d=t(208);async function s(e="",n={}){const t=d.ServerConnection.makeSettings(),o=l.URLExt.join(t.baseUrl,"jupyterlab-pioneer",e);let i;try{i=await d.ServerConnection.makeRequest(o,n,t)}catch(e){throw new d.ServerConnection.NetworkError(e)}let a=await i.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new d.ServerConnection.ResponseError(i,a.message||a);return a}var c=t(211);class v{listen(e,n){e.content.activeCellChanged.connect((async(t,o)=>{if(o&&e.content.widgets){const t={id:null==o?void 0:o.model.id,index:e.content.widgets.findIndex((e=>e===o))},i={eventName:v.id,eventTime:Date.now(),eventInfo:{cells:[t]}};n.exporters.forEach((async t=>{var o,a,l;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(v.id))&&await n.publishEvent(e,i,t,null===(l=null===(a=t.activeEvents)||void 0===a?void 0:a.find((e=>e.name==v.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}v.id="ActiveCellChangeEvent";class r{listen(e,n){var t;null===(t=e.content.model)||void 0===t||t.cells.changed.connect((async(t,o)=>{if("add"===o.type){const t={id:o.newValues[0].id,index:o.newIndex},i={eventName:r.id,eventTime:Date.now(),eventInfo:{cells:[t]}};n.exporters.forEach((async t=>{var o,a,l;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(r.id))&&await n.publishEvent(e,i,t,null===(l=null===(a=t.activeEvents)||void 0===a?void 0:a.find((e=>e.name==r.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}r.id="CellAddEvent";class u{listen(e,n){var t,o;const i=async(t,o)=>{var i,a;await(null==o?void 0:o.ready);const l=null==o?void 0:o.editor,d={eventName:u.id,eventTime:Date.now(),eventInfo:{index:e.content.widgets.findIndex((e=>e===o)),doc:null===(a=null===(i=null==l?void 0:l.state)||void 0===i?void 0:i.doc)||void 0===a?void 0:a.toJSON()}};n.exporters.forEach((async t=>{var o,i,a;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(u.id))&&await n.publishEvent(e,d,t,null===(a=null===(i=t.activeEvents)||void 0===i?void 0:i.find((e=>e.name==u.id)))||void 0===a?void 0:a.logWholeNotebook)}))},a=async t=>{await(null==t?void 0:t.ready);const o=null==t?void 0:t.editor;null==o||o.injectExtension(c.EditorView.updateListener.of((async o=>{if(o.docChanged){const i={eventName:u.id,eventTime:Date.now(),eventInfo:{index:e.content.widgets.findIndex((e=>e===t)),changes:o.changes.toJSON()}};n.exporters.forEach((async t=>{var o;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(u.id))&&await n.publishEvent(e,i,t,!1)}))}})))};null===(t=null==e?void 0:e.content)||void 0===t||t.widgets.forEach((e=>{a(e)})),i(e.content,e.content.activeCell),null===(o=e.content.model)||void 0===o||o.cells.changed.connect((async(n,t)=>{var o;"add"===t.type&&a(null===(o=null==e?void 0:e.content)||void 0===o?void 0:o.widgets[t.newIndex])})),e.content.activeCellChanged.connect(i)}}u.id="CellEditEvent";class m{listen(e,n){o.NotebookActions.executed.connect((async(t,o)=>{if(e.content===o.notebook){const t={id:o.cell.model.id,index:o.notebook.widgets.findIndex((e=>e==o.cell))},i={eventName:m.id,eventTime:Date.now(),eventInfo:{cells:[t],success:o.success,kernelError:o.success?null:o.error}};n.exporters.forEach((async t=>{var o,a,l;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(m.id))&&await n.publishEvent(e,i,t,null===(l=null===(a=t.activeEvents)||void 0===a?void 0:a.find((e=>e.name==m.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}m.id="CellExecuteEvent";class p{listen(e,n){var t;null===(t=e.content.model)||void 0===t||t.cells.changed.connect((async(t,o)=>{if("remove"===o.type){const t={index:o.oldIndex},i={eventName:p.id,eventTime:Date.now(),eventInfo:{cells:[t]}};n.exporters.forEach((async t=>{var o,a,l;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(p.id))&&await n.publishEvent(e,i,t,null===(l=null===(a=t.activeEvents)||void 0===a?void 0:a.find((e=>e.name==p.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}p.id="CellRemoveEvent";class E{listen(e,n){e.node.addEventListener("copy",(async()=>{var t,o;const i={id:null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id,index:e.content.widgets.findIndex((n=>n===e.content.activeCell))},a=null===(o=document.getSelection())||void 0===o?void 0:o.toString(),l={eventName:E.id,eventTime:Date.now(),eventInfo:{cells:[i],selection:a}};n.exporters.forEach((async t=>{var o,i,a;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(E.id))&&await n.publishEvent(e,l,t,null===(a=null===(i=t.activeEvents)||void 0===i?void 0:i.find((e=>e.name==E.id)))||void 0===a?void 0:a.logWholeNotebook)}))}))}}E.id="ClipboardCopyEvent";class h{listen(e,n){e.node.addEventListener("cut",(async()=>{var t,o;const i={id:null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id,index:e.content.widgets.findIndex((n=>n===e.content.activeCell))},a=null===(o=document.getSelection())||void 0===o?void 0:o.toString(),l={eventName:h.id,eventTime:Date.now(),eventInfo:{cells:[i],selection:a}};n.exporters.forEach((async t=>{var o,i,a;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(h.id))&&await n.publishEvent(e,l,t,null===(a=null===(i=t.activeEvents)||void 0===i?void 0:i.find((e=>e.name==h.id)))||void 0===a?void 0:a.logWholeNotebook)}))}))}}h.id="ClipboardCutEvent";class b{listen(e,n){e.node.addEventListener("paste",(async t=>{var o;const i={id:null===(o=e.content.activeCell)||void 0===o?void 0:o.model.id,index:e.content.widgets.findIndex((n=>n===e.content.activeCell))},a=(t.clipboardData||window.clipboardData).getData("text"),l={eventName:b.id,eventTime:Date.now(),eventInfo:{cells:[i],selection:a}};n.exporters.forEach((async t=>{var o,i,a;(null===(o=t.activeEvents)||void 0===o?void 0:o.map((e=>e.name)).includes(b.id))&&await n.publishEvent(e,l,t,null===(a=null===(i=t.activeEvents)||void 0===i?void 0:i.find((e=>e.name==b.id)))||void 0===a?void 0:a.logWholeNotebook)}))}))}}b.id="ClipboardPasteEvent";class f{listen(e,n){document.addEventListener("visibilitychange",(async t=>{if("hidden"===document.visibilityState&&document.contains(e.node)){const t={eventName:f.id,eventTime:Date.now(),eventInfo:null};n.exporters.forEach((async o=>{var i,a,l;(null===(i=o.activeEvents)||void 0===i?void 0:i.map((e=>e.name)).includes(f.id))&&await n.publishEvent(e,t,o,null===(l=null===(a=o.activeEvents)||void 0===a?void 0:a.find((e=>e.name==f.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}f.id="NotebookHiddenEvent";class g{constructor(){this.produced=!1}async listen(e,n){if(!this.produced){const t={eventName:g.id,eventTime:Date.now(),eventInfo:{environ:await s("environ")}};n.exporters.forEach((async o=>{var i,a,l;(null===(i=o.activeEvents)||void 0===i?void 0:i.map((e=>e.name)).includes(g.id))&&(await n.publishEvent(e,t,o,null===(l=null===(a=o.activeEvents)||void 0===a?void 0:a.find((e=>e.name==g.id)))||void 0===l?void 0:l.logWholeNotebook),this.produced=!0)}))}}}g.id="NotebookOpenEvent";class y{listen(e,n){e.context.saveState.connect((async(t,o)=>{if(o.match("completed")){const t={eventName:y.id,eventTime:Date.now(),eventInfo:null};n.exporters.forEach((async o=>{var i,a,l;(null===(i=o.activeEvents)||void 0===i?void 0:i.map((e=>e.name)).includes(y.id))&&await n.publishEvent(e,t,o,null===(l=null===(a=o.activeEvents)||void 0===a?void 0:a.find((e=>e.name==y.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}y.id="NotebookSaveEvent";const w=e=>{const n=[];for(let t=0;t<e.content.widgets.length;t++){const o=e.content.widgets[t],i=o.node.offsetTop,a=o.node.offsetTop+o.node.offsetHeight,l=e.node.getElementsByClassName("jp-WindowedPanel-outer")[0].scrollTop;i<=e.content.node.getElementsByClassName("jp-WindowedPanel-outer")[0].scrollTop+e.content.node.getElementsByClassName("jp-WindowedPanel-outer")[0].clientHeight&&a>=l&&n.push({id:o.model.id,index:t})}return n};class N{constructor(){this.timeout=0}listen(e,n){e.node.getElementsByClassName("jp-WindowedPanel-outer")[0].addEventListener("scroll",(async t=>{t.stopPropagation(),clearTimeout(this.timeout),await new Promise((e=>this.timeout=window.setTimeout(e,1500)));const o={eventName:N.id,eventTime:Date.now(),eventInfo:{cells:w(e)}};n.exporters.forEach((async t=>{var i,a,l;(null===(i=t.activeEvents)||void 0===i?void 0:i.map((e=>e.name)).includes(N.id))&&await n.publishEvent(e,o,t,null===(l=null===(a=t.activeEvents)||void 0===a?void 0:a.find((e=>e.name==N.id)))||void 0===l?void 0:l.logWholeNotebook)}))}))}}N.id="NotebookScrollEvent";class x{listen(e,n){document.addEventListener("visibilitychange",(async()=>{if("visible"===document.visibilityState&&document.contains(e.node)){const t={eventName:x.id,eventTime:Date.now(),eventInfo:{cells:w(e)}};n.exporters.forEach((async o=>{var i,a,l;(null===(i=o.activeEvents)||void 0===i?void 0:i.map((e=>e.name)).includes(x.id))&&await n.publishEvent(e,t,o,null===(l=null===(a=o.activeEvents)||void 0===a?void 0:a.find((e=>e.name==x.id)))||void 0===l?void 0:l.logWholeNotebook)}))}}))}}x.id="NotebookVisibleEvent";const k=[v,r,m,p,u,E,h,b,f,g,y,N,x];var C=t(29),T=t(405);const I="jupyterlab-pioneer:plugin",j=new a.Token(I);class S{constructor(){this.exporters=[]}async loadExporters(e){var n;const t=await s("config"),o=t.activeEvents,i=(null===(n=e.content.model)||void 0===n?void 0:n.getMetadata("exporters"))||t.exporters,a=o&&o.length?i.map((e=>(e.activeEvents||(e.activeEvents=o),e))):i.filter((e=>e.activeEvents&&e.activeEvents.length));console.log(a),this.exporters=a}async publishEvent(e,n,t,o){var i,a;if(!e)throw Error("router is listening to a null notebook panel");const l={eventDetail:n,notebookState:{sessionID:null===(i=null==e?void 0:e.sessionContext.session)||void 0===i?void 0:i.id,notebookPath:null==e?void 0:e.context.path,notebookContent:o?null===(a=null==e?void 0:e.model)||void 0===a?void 0:a.toJSON():null},exporter:t},d=await s("export",{method:"POST",body:JSON.stringify(l)});console.log(d)}}const D={id:I,autoStart:!0,requires:[o.INotebookTracker,i.IMainMenu],provides:j,activate:async(e,n,t)=>{const o=await s("version");console.log(`${I}: ${o}`);const i=await s("config"),a=new S;return((e,n,t)=>{e.commands.addCommand("help:pioneer",{label:"JupyterLab Pioneer",execute:()=>{const e=C.createElement("span",{className:"jp-About-header"},"JupyterLab Pioneer",C.createElement("div",{className:"jp-About-header-info"},C.createElement("span",{className:"jp-About-version-info"},C.createElement("span",{className:"jp-About-version"},"Version ",t)))),n=C.createElement("span",{className:"jp-About-externalLinks"},C.createElement("a",{href:"https://github.com/educational-technology-collective/jupyterlab-pioneer/graphs/contributors",target:"_blank",rel:"noopener noreferrer",className:"jp-Button-flat"},"CONTRIBUTOR LIST"),C.createElement("a",{href:"https://jupyterlab-pioneer.readthedocs.io/en/latest/",target:"_blank",rel:"noopener noreferrer",className:"jp-Button-flat"},"DOCUMENTATION"),C.createElement("a",{href:"https://github.com/educational-technology-collective/jupyterlab-pioneer",target:"_blank",rel:"noopener noreferrer",className:"jp-Button-flat"},"GITHUB REPO")),o=C.createElement("span",{className:"jp-About-copyright"},"Â© 2023 Educational Technology Collective"),i=C.createElement("div",{className:"jp-About-body"},n,o);return(0,T.showDialog)({title:e,body:i,buttons:[T.Dialog.createButton({label:"Dismiss",className:"jp-About-button jp-mod-reject jp-mod-styled"})]})}}),n.helpMenu.addGroup([{command:"help:pioneer"}])})(e,t,o),n.widgetAdded.connect((async(e,n)=>{await n.revealed,await n.sessionContext.ready,await a.loadExporters(n),k.forEach((e=>{(new e).listen(n,a)}))})),((e,n)=>{const t=e.map((e=>{var n;return(null===(n=e.args)||void 0===n?void 0:n.id)||e.type})).join(" & ");let o;o=t?`Telemetry data is being logged to ${t} through jupyterlab-pioneer. \n See Help menu -> JupyterLab Pioneer for more details.`:t?`Embedded telemetry settings loaded. Telemetry data is being logged to ${t} now.`:"Telemetry data is being logged through jupyterlab-pioneer. \n See Help menu -> JupyterLab Pioneer for more details.",T.Notification.info(o,{autoClose:2e4})})(i.exporters),a}}}}]);